{"version":3,"file":"count-devices.js","sources":["../../src/scripts/count-devices.js"],"sourcesContent":["if (typeof GPUAdapter !== 'undefined') {\n  let maxActiveDevices = 0;\n  let allDevices = [];\n\n  // \n  function updateDevices() {\n    const countBefore = allDevices.length;\n    // remove GCed devices\n    allDevices = allDevices.filter(v => !!v.deref());\n    const numGarbageCollectedDevices = countBefore - allDevices.length;\n    if (numGarbageCollectedDevices > 0) {\n      console.info('num garbage collected devices:', numGarbageCollectedDevices);\n    }\n\n    console.info('num active WebGPU devices', allDevices.length);\n    if ( allDevices.length > maxActiveDevices) {\n      maxActiveDevices = allDevices.length;\n      console.info('maximum active WebGPU devices', maxActiveDevices);\n    }\n  }\n\n  GPUAdapter.prototype.requestDevice = (function(origFn) {\n    return async function(...args) {\n      const device = await origFn.call(this, ...args);\n      if (device) {\n        allDevices.push(new WeakRef(device));\n        updateDevices();\n      }\n      return device;\n    };\n  })(GPUAdapter.prototype.requestDevice);\n\n  GPUDevice.prototype.destroy = (function(origFn) {\n    return function(...args) {\n      const ndx = allDevices.findIndex(v => v.deref() === this);\n      if (ndx >= 0) {\n        allDevices.splice(ndx, 1);\n      }\n      origFn.call(this, ...args);\n      updateDevices();\n    }\n  })(GPUDevice.prototype.destroy);\n}\n\ndocument.currentScript?.remove();\n"],"names":[],"mappings":";;;;EAAA,IAAI,OAAO,UAAU,KAAK,WAAW,EAAE;EACvC,EAAE,IAAI,gBAAgB,GAAG,CAAC;EAC1B,EAAE,IAAI,UAAU,GAAG,EAAE;;EAErB;EACA,EAAE,SAAS,aAAa,GAAG;EAC3B,IAAI,MAAM,WAAW,GAAG,UAAU,CAAC,MAAM;EACzC;EACA,IAAI,UAAU,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC;EACpD,IAAI,MAAM,0BAA0B,GAAG,WAAW,GAAG,UAAU,CAAC,MAAM;EACtE,IAAI,IAAI,0BAA0B,GAAG,CAAC,EAAE;EACxC,MAAM,OAAO,CAAC,IAAI,CAAC,gCAAgC,EAAE,0BAA0B,CAAC;EAChF;;EAEA,IAAI,OAAO,CAAC,IAAI,CAAC,2BAA2B,EAAE,UAAU,CAAC,MAAM,CAAC;EAChE,IAAI,KAAK,UAAU,CAAC,MAAM,GAAG,gBAAgB,EAAE;EAC/C,MAAM,gBAAgB,GAAG,UAAU,CAAC,MAAM;EAC1C,MAAM,OAAO,CAAC,IAAI,CAAC,+BAA+B,EAAE,gBAAgB,CAAC;EACrE;EACA;;EAEA,EAAE,UAAU,CAAC,SAAS,CAAC,aAAa,GAAG,CAAC,SAAS,MAAM,EAAE;EACzD,IAAI,OAAO,eAAe,GAAG,IAAI,EAAE;EACnC,MAAM,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,IAAI,CAAC;EACrD,MAAM,IAAI,MAAM,EAAE;EAClB,QAAQ,UAAU,CAAC,IAAI,CAAC,IAAI,OAAO,CAAC,MAAM,CAAC,CAAC;EAC5C,QAAQ,aAAa,EAAE;EACvB;EACA,MAAM,OAAO,MAAM;EACnB,KAAK;EACL,GAAG,EAAE,UAAU,CAAC,SAAS,CAAC,aAAa,CAAC;;EAExC,EAAE,SAAS,CAAC,SAAS,CAAC,OAAO,GAAG,CAAC,SAAS,MAAM,EAAE;EAClD,IAAI,OAAO,SAAS,GAAG,IAAI,EAAE;EAC7B,MAAM,MAAM,GAAG,GAAG,UAAU,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,KAAK,IAAI,CAAC;EAC/D,MAAM,IAAI,GAAG,IAAI,CAAC,EAAE;EACpB,QAAQ,UAAU,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC;EACjC;EACA,MAAM,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,IAAI,CAAC;EAChC,MAAM,aAAa,EAAE;EACrB;EACA,GAAG,EAAE,SAAS,CAAC,SAAS,CAAC,OAAO,CAAC;EACjC;;EAEA,QAAQ,CAAC,aAAa,EAAE,MAAM,EAAE;;;;;;"}