{"version":3,"file":"service-worker.js","sources":["../../src/scripts/service-worker.js"],"sourcesContent":["function log(...args) {\n  // console.log(...args);\n}\n\nlog('hello from service-worker.js');\n\nfunction getContentScripts(settings) {\n  settings = settings ?? {};\n  const scripts = [];\n\n  const injectScript = (url) => {\n    scripts.push(url);\n  }\n\n  if (settings.showCallCounts) {\n    injectScript('scripts/show-call-counts.js');\n  }\n\n  if (settings.showRedundantStateSetting) {\n    injectScript('scripts/show-redundant-state-setting.js');\n  }\n\n  if (settings.enforceDefaultLimits) {\n    injectScript('scripts/enforce-default-limits.js');\n  }\n\n  if (settings.removeWebGPU) {\n    injectScript('scripts/remove-webgpu.js');\n  }\n\n  if (settings.countActiveDevices) {\n    injectScript('scripts/count-devices.js');\n  }\n\n  if (settings.blockFeatures) {\n    injectScript('scripts/block-features.js');\n  }\n\n  if (settings.capture) {\n    injectScript('scripts/webgpu_recorder.js');\n    injectScript('scripts/gpu-injected.js');\n  }\n\n  if (settings.compat) {\n    injectScript('scripts/webgpu-compat-validation.js');\n  }\n\n  if (settings.customFormatters) {\n    injectScript('scripts/custom-formatters.js');\n  }\n\n  switch (settings.forceMode) {\n    case 'low-power':\n      injectScript('scripts/force-low-power.js');\n      break;\n    case 'high-performance':\n      injectScript('scripts/force-high-performance.js');\n      break;\n    case 'compatibility-mode':\n      injectScript('scripts/force-compatibility-mode.js');\n      break;\n    case 'force-fallback-adapter':\n      injectScript('scripts/force-fallback-adapter.js');\n      break;\n  }\n\n  if (settings.dumpShaders) {\n    injectScript('scripts/dump-shaders.js');\n  }\n\n  if (settings.autoLabel) {\n    injectScript('scripts/auto-label.js');\n  }\n\n  if (settings.addDescriptors) {\n    injectScript('scripts/add-descriptors.js');\n  }\n\n  if (settings.trackPassState) {\n    injectScript('scripts/track-pass-state.js');\n  }\n\n  if (settings.webgpuDebugHelper) {\n    injectScript('scripts/webgpu-debug-helper.js');\n  } else if (settings.showErrors) {\n    injectScript('scripts/show-errors.js');\n  }\n\n  if (settings.showShaderErrors) {\n    injectScript('scripts/show-shader-errors.js');\n  }\n\n  if (settings.showAdapterInfo) {\n    injectScript('scripts/show-adapter-info.js');\n  }\n\n  if (settings.showCalls) {\n    injectScript('scripts/show-calls.js');\n  }\n\n  if (settings.breakpoints) {\n    injectScript('scripts/breakpoints.js');\n  }\n\n  if (settings.disableWebGPU) {\n    injectScript('scripts/disable-webgpu.js');\n  }\n\n  if (settings.showMemory) {\n    injectScript('scripts/show-memory.js');\n  }\n\n  if (settings.rafSkipFrames || (settings.timeMult !== undefined && settings.timeMult !== 1)) {\n    injectScript('scripts/raf-skip-frames.js');\n  }\n\n  return scripts;\n}\n\nconst commands = {\n  async registerScripts({tabId, settings}) {\n    log('tabId:', tabId);\n    await chrome.scripting.unregisterContentScripts();\n\n    log('registering scripts');\n    const scripts = getContentScripts(settings);\n    if (scripts.length) {\n      log(scripts.map(s => `  ${s}`).join('\\n'));\n      chrome.scripting.registerContentScripts([\n        {\n          id: 'webgpu-dev-extension-content-helper',  // Unique identifier\n          matches: ['<all_urls>'],                    // URL patterns to match\n          js: ['scripts/extension-helper.js'],        // Script file(s) to inject\n          runAt: 'document_start',                    // When to inject the script\n          allFrames: true,                            // Inject only into the top frame\n        },\n        {\n          id: 'webgpu-dev-extension-content-scripts', // Unique identifier\n          matches: ['<all_urls>'],                    // URL patterns to match\n          js: scripts,                                // Script file(s) to inject\n          runAt: 'document_start',                    // When to inject the script\n          allFrames: true,                            // Inject only into the top frame\n          world: \"MAIN\",\n        },\n      ], () => {\n        if (chrome.runtime.lastError) {\n          console.error('Error registering content script:', chrome.runtime.lastError);\n        } else {\n          log('Content script registered successfully!');\n        }\n      });\n    } else {\n      log('no scripts');\n    }\n  },\n  async getSettings(data, sender, sendResponse) {\n    const keys = await chrome.storage.session.get(['webgpu-dev-extension-settings']);\n    log(keys);\n    const settings = (keys && keys['webgpu-dev-extension-settings']) ?? {};\n    log(settings);\n    sendResponse(settings);\n  },\n};\n\nlog('addListener in service-worker.js');\n\nchrome.runtime.onMessage.addListener((msg, sender, sendResponse) => {\n  log('got message from popup', msg);\n  const {cmd, data} = msg;\n  const fn = commands[cmd];\n  if (!fn) {\n    console.error('unknown command from devTools:', cmd, msg);\n    return;\n  }\n  fn(data, sender, sendResponse);\n  return true;\n});\n"],"names":[],"mappings":"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"}