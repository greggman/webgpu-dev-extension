{"version":3,"file":"track-pass-state.js","sources":["../../src/scripts/track-pass-state.js"],"sourcesContent":["if (typeof GPUDevice !== 'undefined') {\n  function addStateWrapper(API, fnName, fn) {\n    const origFn = API.prototype[fnName];\n    API.prototype[fnName] = function (...args) {\n      fn(this.state, ...args);\n      return origFn.call(this, ...args);\n    };\n  }\n\n  GPUCommandEncoder.prototype.beginComputePass = (function(origFn) {\n    return function(desc = {}) {\n      const result = origFn.call(this, desc);\n      result.state = {\n        bindGroups: [],\n      };\n      return result;\n    };\n  })(GPUCommandEncoder.prototype.beginComputePass);\n\n  GPUCommandEncoder.prototype.beginRenderPass = (function(origFn) {\n    return function(desc = {}) {\n      const result = origFn.call(this, desc);\n      result.state = {\n        bindGroups: [],\n        vertexBuffers: [],\n      };\n      return result;\n    };\n  })(GPUCommandEncoder.prototype.beginRenderPass);\n\n  GPUDevice.prototype.createRenderBundle = (function(origFn) {\n    return function(desc = {}) {\n      const result = origFn.call(this, desc);\n      result.state = {\n        bindGroups: [],\n        vertexBuffers: [],\n      };\n      return result;\n    };\n  })(GPUDevice.prototype.createRenderBundle);\n\n  addStateWrapper(GPUComputePassEncoder, 'setBindGroup', (state, group, bindGroup) => {\n    state.bindGroups[group] = bindGroup;\n  });\n\n  addStateWrapper(GPUComputePassEncoder, 'setPipeline', (state, pipeline) => {\n    state.pipeline = pipeline;\n  });\n\n  addStateWrapper(GPURenderPassEncoder, 'executeBundles', (state) => {\n    state.bindGroups.length = 0;\n    state.vertexBuffers.length = 0;\n    delete state.pipeline;\n    delete state.indexBuffer;\n  });\n\n  for (const api of [GPURenderPassEncoder, GPURenderBundleEncoder]) {\n    addStateWrapper(GPURenderPassEncoder, 'setPipeline', (state, pipeline) => {\n      state.pipeline = pipeline;\n    });\n\n    addStateWrapper(GPURenderPassEncoder, 'setBindGroup', (state, group, bindGroup, ...args) => {\n      if (args.length === 0) {\n        state.bindGroups[group] = { bindGroup };\n      } else if (args.length === 1) {\n        state.bindGroups[group] = { bindGroup, dynamicOffsets: args[0] };\n      } else {\n        state.bindGroups[group] = {\n          bindGroup, \n          dynamicOffsetsData: args[0],\n          dynamicOffsetsDataStart: args[1],\n          dynamicOffsetsDataLength: args[2],      \n         };\n      }\n    });\n\n    addStateWrapper(GPURenderPassEncoder, 'setVertexBuffer', (state, slot, vertexBuffer, offset = 0, size) => {\n      state.vertexBuffers[slot] = { vertexBuffer, offset, size: size === undefined ? vertexBuffer.size : size };\n    });\n\n    addStateWrapper(GPURenderPassEncoder, 'setIndexBuffer', (state, indexBuffer, indexFormat, offset = 0, size) => {\n      state.indexBuffer = { indexBuffer, indexFormat, offset, size: size === undefined ? indexBuffer.size : size };\n    });\n  }\n\n  addStateWrapper(GPURenderPassEncoder, 'setViewport', (state, ...args) => {\n    state.viewport = args;\n  });\n\n  addStateWrapper(GPURenderPassEncoder, 'setScissorRect', (state, ...args) => {\n    state.scissorRect = args;\n  });\n\n  addStateWrapper(GPURenderPassEncoder, 'setBlendConstant', (state, ...args) => {\n    state.blendConstant = args[0];\n  });\n\n  addStateWrapper(GPURenderPassEncoder, 'setStencilReference', (state, ...args) => {\n    state.stencilReference = args[0];\n  });\n\n  addStateWrapper(GPURenderPassEncoder, 'beginOcclusionQuery', (state, ...args) => {\n    state.queryIndex = args[0];\n  });\n \n  addStateWrapper(GPURenderPassEncoder, 'endOcclusionQuery', (state, ...args) => {\n    delete state.queryIndex;\n  });\n \n}\n\ndocument.currentScript?.remove();\n"],"names":[],"mappings":"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"}