{"version":3,"file":"custom-formatters.js","sources":["../../src/scripts/custom-formatters.js"],"sourcesContent":["if (typeof GPUAdapter !== 'undefined') {\n  console.log('webgpu-dev-extension: custom-formatters');\n\n  const expandStyle = {style: 'list-style-type: none; margin: 0; padding-left: 24px;'};\n\n  const headerConfig = {\n    innerTag: 'span',\n    nameStyle: { style: 'color: var(--sys-color-token-subtle' },\n    valueStyle: { style: 'color: var(--sys-color-token-attribute-value' },\n    propertySpecialStyle: { style: 'color: var(--sys-color-token-property-special' },\n    format(object, props) {\n      return [\n        'span',\n        ['span', `${object.constructor.name} {`],\n        ...props.flatMap(v => [', ', v]).slice(1),\n        '}',\n      ];\n    },\n  };\n\n  const bodyConfig = {\n    innerTag: 'li',\n    nameStyle: { style: 'color: var(--sys-color-token-tag);' },\n    valueStyle: { style: 'color: var(--sys-color-token-attribute-value' },\n    propertySpecialStyle: { style: 'color: var(--sys-color-token-property-special' },\n    format(object, props) {\n      return [\n        'ol', expandStyle, ...props,\n      ];\n    },\n  };\n\n  function getJsonML(object, config) {\n    const {\n      innerTag,\n      nameStyle,\n      propertyFormatters,\n    } = config;\n\n    function getValue(key, value) {\n      const formatter = propertyFormatters[key];\n      return formatter\n        ? formatter(key, value, config)\n        : ['object', {object: value}];\n    }\n\n    const props = [];\n    for (const key in object) {\n      const value = object[key];\n      if (typeof value !== 'function') {\n        props.push([\n            innerTag,\n            ['span', nameStyle, key],\n            ': ',\n            getValue(key, value),\n        ]);\n      }\n    }\n\n    return props;\n  }\n\n  function bitmaskToString(bitNames, value) {\n    const names = [];\n    for (const [k, v] of Object.entries(bitNames)) {\n      if (value & v) {\n        names.push(k);\n      }\n    }\n    return names.join('|');\n  }\n\n  function getBitmaskJsonML(bitNames, value, { valueStyle, propertySpecialStyle }) {\n    return [\n      'span',\n      ['span', valueStyle, `${value}`],\n      ' (',\n      ['span', propertySpecialStyle, `${bitmaskToString(bitNames, value)}`],\n      ')',\n    ];\n  }\n\n  function getSetAsArrayJsonML(value) {\n    const array = [...value.values()].sort();\n    return ['object', {object: array}];\n  }\n\n  const gpuBufferPropertyFormatters = {\n    usage(key, value, config) {\n      return getBitmaskJsonML(GPUBufferUsage, value, config);\n    },\n  };\n\n  const gpuTexturePropertyFormatters = {\n    usage(key, value, config) {\n      return getBitmaskJsonML(GPUTextureUsage, value, config);\n    },\n  };\n\n  const gpuHeapPropertyFormatters = {\n    properties(key, value, config) {\n      return getBitmaskJsonML(GPUHeapProperty, value, config);\n    },\n  };\n\n  const gpuAdapterPropertyFormatters = {\n    features(key, value, config) {\n      return getSetAsArrayJsonML(value, config);\n    },\n  };\n\n  const gpuDevicePropertyFormatters = {\n    features(key, value, config) {\n      return getSetAsArrayJsonML(value, config);\n    },\n  };\n\n  function format(object, config) {\n    const props = getJsonML(object, config);\n    return config.format(object, props, config);\n  }\n\n  const gpuBufferConfig = {\n    header: {\n      ...headerConfig,\n      propertyFormatters: gpuBufferPropertyFormatters,\n    },\n    body: {\n      ...bodyConfig,\n      propertyFormatters: gpuBufferPropertyFormatters,\n    },\n  };\n\n  const gpuTextureConfig = {\n    header: {\n      ...headerConfig,\n      propertyFormatters: gpuTexturePropertyFormatters,\n    },\n    body: {\n      ...bodyConfig,\n      propertyFormatters: gpuTexturePropertyFormatters,\n    },\n  };\n\n  const gpuHeapPropertyConfig = {\n    header: {\n      ...headerConfig,\n      propertyFormatters: gpuHeapPropertyFormatters,\n    },\n    body: {\n      ...bodyConfig,\n      propertyFormatters: gpuHeapPropertyFormatters,\n    },\n  };\n\n  const gpuAdapterConfig = {\n    header: {\n      ...headerConfig,\n      propertyFormatters: gpuAdapterPropertyFormatters,\n    },\n    body: {\n      ...bodyConfig,\n      propertyFormatters: gpuAdapterPropertyFormatters,\n    },\n  };\n\n  const gpuDeviceConfig = {\n    header: {\n      ...headerConfig,\n      propertyFormatters: gpuDevicePropertyFormatters,\n    },\n    body: {\n      ...bodyConfig,\n      propertyFormatters: gpuDevicePropertyFormatters,\n    },\n  };\n\n  function getConfig(object) {\n    if (object instanceof GPUBuffer) {\n      return gpuBufferConfig;\n    }\n    if (object instanceof GPUTexture) {\n      return gpuTextureConfig;\n    }\n    if (typeof GPUMemoryHeapInfo !== 'undefined' && object instanceof GPUMemoryHeapInfo) {\n      return gpuHeapPropertyConfig;\n    }\n    if (object instanceof GPUAdapter) {\n      return gpuAdapterConfig;\n    }\n    if (object instanceof GPUDevice) {\n      return gpuDeviceConfig;\n    }\n    return undefined;\n  }\n\n  const WebGPUDevtoolsFormatter = {\n    header: (object) => {\n      const config = getConfig(object);\n      return config\n         ? format(object, config.header)\n         : false;\n    },\n    hasBody: () => true,\n    body: (object) => {\n      const config = getConfig(object);\n      return config\n         ? format(object, config.body)\n         : null;\n    },\n  };\n\n  window.devtoolsFormatters = [...(window.devtoolsFormatters || []), WebGPUDevtoolsFormatter];\n}\n"],"names":[],"mappings":"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"}