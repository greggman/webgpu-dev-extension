{"version":3,"file":"breakpoints.js","sources":["../../src/scripts/breakpoints.js"],"sourcesContent":["if (typeof GPUDevice !== 'undefined') {\n  const log = (...args) => {\n    //  console.log(...args);\n  };\n\n  const settingsPromise = new Promise((resolve, reject) => {\n    document.addEventListener('webgpu-dev-extension-settings', (event) => {\n      // Handle data from event.detail\n      log('got special event:', event);\n      setBreakpoints(event.detail);\n      resolve(event.detail);\n    }, { once: true });\n    log('sent message');\n    document.dispatchEvent(new CustomEvent('webgpu-dev-extension-event', {\n      detail: {\n        cmd: 'getSettings',\n      },\n    }));\n  });\n\n  function forEachFunction(filter, fn) {\n    const APIs = [\n      GPU,\n      GPUAdapter,\n      GPUBuffer,\n      GPUCanvasContext,\n      GPUCommandEncoder,\n      GPUComputePassEncoder,\n      GPUDevice,\n      GPUQueue,\n      GPUQuerySet,\n      GPURenderBundleEncoder,\n      GPURenderPassEncoder,\n      GPUTexture,\n    ];\n\n    for (const API of APIs) {\n      const prototype = API.prototype;\n      const methodNames = Object.entries(Object.getOwnPropertyDescriptors(prototype))\n          .filter(([k, v]) => filter(k) && v.writable && v.enumerable && v.configurable && typeof v.value === 'function')\n          .map(([k]) => k);\n      for (const name of methodNames) {\n        const id = `${API.prototype.constructor.name}.${name}`;\n        fn(id, API, name, API.prototype[name]);\n      }\n    }\n  }\n\n  // The ids (API.methodName) that we want to break at.\n  const s_breakpointIds = new Set();\n\n  // This is called when the event with our settings arrives\n  // which is after user code has started. But, we'll pause\n  // when they ask for an adapter, wait for that event, then call this\n  // before returning the adapter (see requestAdapter) \n  function setBreakpoints(settings) {\n    const breakpointStrings = (settings.breakpoints || '').split(/[,\\s]+/).map(v => v.trim());\n    const breakpointREs = breakpointStrings.map(v => new RegExp(`^${v.replaceAll('.', '\\\\.').replaceAll('*', '.*')}$`));\n    log(breakpointREs);\n    function needsWrap(methodName) {\n      for (const re of breakpointREs) {\n        if (re.test(methodName)) {\n          return true;\n        }\n      }\n      return false;\n    }\n\n    forEachFunction(needsWrap, (id) => {\n      console.log(`added breakpoint to: ${id}`);\n      s_breakpointIds.add(id);\n    });\n  }\n\n  // We need to wrap all the functions immediately, otherwise the app might\n  // pull out functions before we get a change to wrap them.\n  function addBreakpointWrapper(id, API, methodName, origFn) {\n    let disable = false;    \n    // Set disable (in devtools) to true to disable this specific method breakpoint\n    API.prototype[methodName] = function(...args) {\n      if (s_breakpointIds.has(id) && !disable) {\n        debugger;\n      }\n      return origFn.call(this, ...args);\n    };\n  }\n  forEachFunction(() => true, addBreakpointWrapper);\n\n  GPU.prototype.requestAdapter = (function (origFn) {\n    return async function (desc) {\n      log('waiting for settings');\n      await settingsPromise;\n      log('got settings');\n      const adapter = await origFn.call(this, desc);\n      return adapter;\n    };\n  })(GPU.prototype.requestAdapter);\n}\n\ndocument.currentScript?.remove();\n"],"names":[],"mappings":"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"}